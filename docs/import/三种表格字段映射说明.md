# 三种表格字段映射说明

## 📊 表格类型概览

系统支持导入三种Temu平台导出的表格：

1. **订单列表** - 订单导出数据
2. **活动列表** - 活动商品明细
3. **商品基础信息表** - 商品信息

## 🔄 字段映射详情

### 1. 订单列表（订单导出）

**表格链接**：https://mcnkufobiqbi.feishu.cn/sheets/W3FwsqMtRhkOwQtmfhWcGjvrn1d

#### 支持的列名（多种格式）

| Excel列名选项 | 数据库字段 | 类型 | 必需 | 说明 |
|--------------|-----------|------|------|------|
| 订单编号 / 订单号 | order_sn | string | ✅ | 订单唯一标识 |
| 商品名称 / 商品 | product_name | string | ✅ | 商品名称 |
| SKU / 商品SKU | product_sku | string | - | 商品SKU编码 |
| 数量 / 购买数量 | quantity | integer | ✅ | 购买数量 |
| 单价 / 商品单价 | unit_price | decimal | ✅ | 单品价格 |
| 订单金额 / 总金额 | total_price | decimal | ✅ | 订单总价 |
| 币种 / 货币 | currency | string | - | 货币类型（默认USD） |
| 订单状态 / 状态 | status | enum | - | 订单状态 |
| 下单时间 / 订单时间 | order_time | datetime | ✅ | 下单时间 |
| 支付时间 | payment_time | datetime | - | 支付时间 |
| 客户ID / 买家ID | customer_id | string | - | 客户标识 |
| 收货国家 / 国家 | shipping_country | string | - | 收货国家 |

#### 订单状态映射

| Excel值 | 系统状态 | 说明 |
|---------|---------|------|
| PENDING / 待支付 | PENDING | 待支付 |
| PAID / 已支付 | PAID | 已支付 |
| SHIPPED / 已发货 | SHIPPED | 已发货 |
| DELIVERED / 已完成 | DELIVERED | 已送达 |
| CANCELLED / 已取消 | CANCELLED | 已取消 |
| REFUNDED / 已退款 | REFUNDED | 已退款 |

#### 数据示例

```
订单编号: ORD20251031001
商品名称: iPhone 15 Pro 手机壳
数量: 2
单价: 9.99
订单金额: 19.98
币种: USD
订单状态: 已发货
下单时间: 2025-10-31 10:30:00
```

---

### 2. 活动列表（活动商品明细）

**表格链接**：https://mcnkufobiqbi.feishu.cn/sheets/GJDWssEifhFpbst6fr8cbUxMn1b

#### 支持的列名

| Excel列名 | 数据库字段 | 类型 | 必需 | 说明 |
|----------|-----------|------|------|------|
| 商品信息 | activity_name | string | ✅ | 生成活动名称 |
| SPU ID | description | string | ✅ | SPU标识 |
| 活动站点 | description | string | - | 活动地区 |
| 活动销量 | description | integer | - | 销量数据 |
| 活动 GMV | budget/actual_cost | decimal | ✅ | 活动金额 |
| 活动商品曝光用户数 | description | integer | - | 曝光量 |
| 活动商品点击用户数 | description | integer | - | 点击量 |
| 活动商品点击转化率 | - | percentage | - | 点击转化率 |
| 活动商品支付转化率 | - | percentage | - | 支付转化率 |

#### 处理逻辑

```python
# 生成活动名称
activity_name = f"活动推广 - {商品信息[:50]}"

# GMV作为预算和成本
budget = 活动GMV
actual_cost = 活动GMV

# 详细信息存储在description中
description = f"""
SPU: {SPU_ID}
销量: {活动销量}
曝光: {活动商品曝光用户数}
点击: {活动商品点击用户数}
"""
```

#### 数据示例

```
商品信息: iPhone 15 Pro 手机壳 透明防摔保护套
SPU ID: SPU123456789
活动站点: US
活动销量: 1250
活动 GMV: 12487.50
活动商品曝光用户数: 25000
活动商品点击用户数: 2500
活动商品点击转化率: 10.00%
活动商品支付转化率: 5.00%
```

---

### 3. 商品基础信息表

**表格链接**：https://mcnkufobiqbi.feishu.cn/sheets/F3UVshBvXhG9RZt9VgtctDeNngM

#### 支持的列名

| Excel列名 | 数据库字段 | 类型 | 必需 | 说明 |
|----------|-----------|------|------|------|
| 商品名称 | product_name | string | ✅ | 商品名称 |
| SKU ID | product_id | string | ✅ | SKU唯一标识 |
| SPU ID | description | string | - | SPU标识 |
| 申报价格 | current_price | decimal | ✅ | 当前价格 |
| 类目 | category | string | - | 商品分类 |
| 状态 | status | string | - | 商品状态 |
| SKU货号 | description | string | - | SKU货号 |

#### 价格解析

支持的格式：
- `999.00元` → 999.00
- `¥999.00` → 999.00
- `999.00` → 999.00
- `999,00` → 999.00

#### 状态映射

| Excel值 | 系统状态 | 说明 |
|---------|---------|------|
| 价格申报中 | active | 活跃商品 |
| 其他 | inactive | 非活跃 |

#### 更新逻辑

```python
# 如果SKU ID已存在
if product_exists:
    # 更新价格信息
    product.current_price = new_price
    action = 'updated'
else:
    # 创建新商品
    product = Product(...)
    action = 'created'
```

#### 数据示例

```
商品名称: iPhone 15 Pro 手机壳 透明防摔
SKU ID: SKU20251031001
SPU ID: SPU123456789
申报价格: 9.99元
类目: 手机配件/保护壳
状态: 价格申报中
SKU货号: ABC-12345-XYZ
```

## 🎯 导入流程

```
1. 用户选择导入类型
   ├─ 订单列表
   ├─ 活动列表
   └─ 商品基础信息

2. 选择数据来源
   ├─ Excel文件上传
   └─ 在线表格链接（飞书）

3. 系统处理
   ├─ 读取数据
   ├─ 字段映射
   ├─ 数据验证
   └─ 导入数据库

4. 结果反馈
   ├─ 成功：XX条
   ├─ 失败：XX条
   └─ 跳过：XX条
```

## ⚠️ 注意事项

### 订单导入

1. **去重规则**：根据`订单编号`判断，已存在的订单会被跳过
2. **必填字段**：订单编号、商品名称、数量、价格、下单时间
3. **自动计算**：如果没有订单金额，系统会根据单价×数量计算

### 活动导入

1. **去重规则**：根据生成的`活动名称`判断
2. **活动名称**：自动生成格式为"活动推广 - {商品名称前50字}"
3. **GMV处理**：GMV同时作为预算(budget)和实际成本(actual_cost)

### 商品导入

1. **去重规则**：根据`SKU ID`判断
2. **更新策略**：已存在的商品会更新价格信息
3. **价格解析**：自动移除"元"、"¥"等货币符号

## 🔧 调试建议

### 检查列名

如果导入失败，首先检查Excel列名是否正确：

```python
# 在系统中支持的列名
订单列表: ['订单编号', '订单号', '商品名称', '商品', ...]
活动列表: ['商品信息', 'SPU ID', '活动 GMV', ...]
商品列表: ['商品名称', 'SKU ID', '申报价格', ...]
```

### 查看错误日志

导入完成后可查看详细错误日志：
```sql
SELECT error_log FROM import_history WHERE id = {import_id};
```

### 常见错误

1. **缺少必填字段**
   - 错误：`缺少订单编号`
   - 解决：确保Excel中有"订单编号"或"订单号"列

2. **日期格式错误**
   - 错误：`无法解析日期`
   - 解决：使用标准格式 `YYYY-MM-DD HH:MM:SS`

3. **价格格式错误**
   - 错误：`无法解析价格`
   - 解决：确保价格为数字格式，可包含"元"、"¥"等符号

## 📖 使用示例

### 示例1：导入订单

```
1. 从Temu平台导出订单数据
2. 打开飞书表格，上传或粘贴数据
3. 复制飞书表格链接
4. 在系统中选择"订单列表" → "在线表格"
5. 粘贴链接 → 开始导入
```

### 示例2：导入活动

```
1. 从Temu后台导出活动商品明细
2. 上传到飞书表格
3. 在系统中选择"活动列表" → 粘贴链接
4. 查看导入结果统计
```

### 示例3：导入商品

```
1. 导出商品基础信息
2. 上传到飞书表格（建议设置密码保护）
3. 在系统中选择"商品基础信息" → "在线表格"
4. 输入表格链接和密码
5. 开始导入（已存在的商品会更新价格）
```

## 🆚 三种类型对比

| 特性 | 订单列表 | 活动列表 | 商品列表 |
|------|----------|----------|----------|
| 主键字段 | 订单编号 | 活动名称 | SKU ID |
| 去重策略 | 跳过重复 | 跳过重复 | 更新价格 |
| 时间字段 | ✅ 必需 | ❌ 无 | ❌ 无 |
| 金额字段 | ✅ 必需 | ✅ 必需 | ✅ 必需 |
| 更新频率 | 高 | 中 | 低 |
| 数据敏感度 | 🔴 高 | 🟡 中 | 🟡 中 |
| 建议密码保护 | ✅ 是 | 建议 | 建议 |

## 💡 最佳实践

1. **数据准备**
   - 确保列名与系统支持的格式一致
   - 删除空行和无效数据
   - 日期使用统一格式

2. **安全性**
   - 订单数据必须设置密码保护
   - 定期更换飞书表格访问密码
   - 不要在公开场合分享表格链接

3. **导入策略**
   - 订单：每日增量导入
   - 活动：活动期间按需导入
   - 商品：价格变动时导入

4. **数据验证**
   - 导入后检查统计数据是否正确
   - 查看错误日志，修正问题数据
   - 重新导入失败的记录

---

**提示**：如果您的Excel列名与上述不完全一致，请联系技术支持添加新的列名映射。


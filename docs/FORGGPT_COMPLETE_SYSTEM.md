# FrogGPT 完整 Prompt 体系使用指南

## 一、体系概述

FrogGPT 采用**三层 Prompt 架构**：

```
┌─────────────────────────────────────┐
│  1. System Prompt（系统提示词）      │  ← 角色定义 + 规则 + 行为约束
├─────────────────────────────────────┤
│  2. Data Context（数据上下文）       │  ← 根据问题动态注入真实数据
├─────────────────────────────────────┤
│  3. Conversation History（对话历史） │  ← 多轮对话上下文
└─────────────────────────────────────┘
```

## 二、System Prompt（核心工作说明书）

### 2.1 角色定位

- **身份**：FrogGPT，专为电商运营打造的数据分析专家
- **能力**：分析订单、商品、店铺、财务等数据
- **目标**：提供清晰、可靠、可执行的运营决策建议

### 2.2 核心规则

#### 规则1：必须使用数据，不可臆测
- 必须使用系统提供的数据上下文
- 不能编造数字
- 数据不足时必须明确告知

#### 规则2：基于关键词自动选择数据上下文
- **订单/GMV/销售** → 订单统计数据
- **商品/SKU/销量** → 商品统计数据
- **店铺** → 店铺列表数据

#### 规则3：回答输出格式
```
📌【核心结论】
📊【关键数据】
📈【详细分析】
📝【可执行建议】
```

#### 规则4：数据不足时必须提示
- 明确告知数据缺失情况
- 不编造理由

## 三、数据上下文注入机制

### 3.1 自动注入逻辑

系统会根据用户问题的关键词，自动注入相关数据：

#### 订单相关数据
**触发关键词**：`订单、order、gmv、销售、sales、销量、趋势、利润、收入、营收、数据、分析、统计`

**注入数据**：
- 最近7天订单统计（GMV、订单量、利润、退款率等）
- 最近30天订单统计（对比数据）

#### 商品相关数据
**触发关键词**：`商品、product、sku、销量、库存、top、畅销、销量前十、利润最高、成本`

**注入数据**：
- 商品总数、在售商品数
- 销量前10商品列表

#### 店铺相关数据
**触发关键词**：`店铺、shop、store、环境、店铺情况、店铺数据`

**注入数据**：
- 店铺总数
- 店铺列表（最多10个）

### 3.2 支持筛选参数

数据上下文支持以下筛选参数：
- `shop_ids`：店铺ID列表（筛选特定店铺）
- `date_range`：日期范围（格式：`{"start": "YYYY-MM-DD", "end": "YYYY-MM-DD"}`）

## 四、工具函数（Tool Functions）

### 4.1 可用工具列表

#### ① get_order_statistics
**功能**：获取订单统计数据（深度聚合版）

**参数**：
- `shop_id`（可选）：店铺ID
- `start_date`（可选）：开始日期（YYYY-MM-DD）
- `end_date`（可选）：结束日期（YYYY-MM-DD）
- `status`（可选）：订单状态

**返回数据**：
- 总订单数、总GMV、总利润
- 平均订单金额、利润率
- 退款订单数、退款率

#### ② query_orders
**功能**：查询订单明细

**参数**：
- `shop_id`（可选）：店铺ID
- `sku`（可选）：SKU货号
- `status`（可选）：订单状态
- `start_time`（可选）：开始时间
- `end_time`（可选）：结束时间
- `limit`（可选）：返回数量限制（默认200）

**返回数据**：订单列表（订单号、商品信息、金额、状态等）

#### ③ get_product_sales
**功能**：获取指定SKU最近30天的销量和GMV

**参数**：
- `shop_id`（可选）：店铺ID
- `sku`（可选）：SKU货号

**返回数据**：销量、GMV、利润

#### ④ get_sku_profit
**功能**：获取 SKU 的利润结构

**参数**：
- `sku`（必需）：SKU货号

**返回数据**：
- 供货价、成本价、毛利率
- 最近30天销量、GMV、利润

#### ⑤ get_shop_list
**功能**：获取所有店铺列表

**参数**：无

**返回数据**：店铺列表（ID、名称、环境、状态等）

### 4.2 工具使用方式

**当前实现**：工具函数已实现，但尚未集成到AI对话流程中。

**未来集成**：
- 可以集成 OpenAI Function Calling
- 或者让AI在回答中提示用户可以使用哪些工具
- 或者在前端提供工具调用按钮

## 五、分析模板

### 5.1 常用模板

1. **今日/昨日销售总结**
2. **最近7天GMV变化原因**
3. **SKU 盈利分析**
4. **商品对比（适合选品）**
5. **退款异常分析**
6. **店铺对比分析**
7. **库存预警分析**
8. **价格策略建议**

详细模板内容请参考：`docs/FORGGPT_ANALYSIS_TEMPLATES.md`

### 5.2 模板使用方式

用户可以直接复制模板中的问题，发送给 ForgGPT，AI 会基于当前数据进行分析。

## 六、实际运行流程示例

### 示例1：用户问"最近7天GMV为什么下降？"

**AI 内部流程**：

1. **识别关键词** → `GMV` → 触发订单数据上下文注入
2. **获取数据上下文** → 系统自动注入最近7天和30天的订单统计
3. **分析数据** → AI 基于注入的数据进行分析
4. **输出结果** → 按照标准格式输出分析结果

**AI 回答示例**：
```
📌【核心结论】
最近7天GMV为50000元，相比上一周下降12%。主要原因是订单量下降和退款率上升。

📊【关键数据】
- 最近7天GMV：50000元
- 订单数：250单
- 客单价：200元
- 退款率：3%（上一周为2%）

📈【详细分析】
1. 订单量下降：最近7天订单250单，相比上一周下降15%
2. 退款率上升：退款率从2%上升到3%，影响GMV约1500元
3. 畅销SKU变化：LBB3系列销量下降明显

📝【可执行建议】
1. 建议加大LBB3系列商品的推广力度
2. 建议优化发货流程，降低退款率
3. 建议关注库存情况，及时补货
```

### 示例2：用户问"哪些商品销量最好？"

**AI 内部流程**：

1. **识别关键词** → `商品`、`销量` → 触发商品数据上下文注入
2. **获取数据上下文** → 系统自动注入商品统计和销量前10商品
3. **分析数据** → AI 基于注入的数据进行分析
4. **输出结果** → 按照标准格式输出分析结果

## 七、代码实现位置

### 7.1 核心服务

- **ForgGPTService**: `backend/app/services/forggpt_service.py`
  - `_get_system_prompt()`: 生成系统提示词
  - `_get_data_context()`: 生成数据上下文
  - `_build_messages()`: 构建消息列表
  - `chat()`: 对话主函数

### 7.2 工具函数

- **ForgGPTTools**: `backend/app/services/forggpt_tools.py`
  - `get_order_statistics()`: 订单统计
  - `query_orders()`: 订单查询
  - `get_product_sales()`: 商品销量
  - `get_sku_profit()`: SKU利润
  - `get_shop_list()`: 店铺列表
  - `TOOLS_SCHEMA`: 工具Schema定义

### 7.3 API端点

- **ForgGPT API**: `backend/app/api/forggpt.py`
  - `POST /api/forggpt/chat`: 对话接口
  - `GET /api/forggpt/history/{session_id}`: 获取对话历史
  - `POST /api/forggpt/upload`: 文件上传（待实现）

## 八、使用示例

### 8.1 基础对话

```python
# 用户问题
message = "最近7天的销售情况如何？"

# 系统自动：
# 1. 识别关键词"销售" → 注入订单数据上下文
# 2. 查询最近7天订单统计
# 3. AI基于数据进行分析
# 4. 返回格式化的分析结果
```

### 8.2 带筛选条件的对话

```python
# 用户问题 + 筛选条件
message = "店铺1最近7天的销售情况如何？"
shop_ids = [1]
date_range = {"start": "2025-01-15", "end": "2025-01-22"}

# 系统自动：
# 1. 识别关键词"销售" → 注入订单数据上下文
# 2. 使用shop_ids和date_range筛选数据
# 3. 查询店铺1在指定时间范围的订单统计
# 4. AI基于筛选后的数据进行分析
```

### 8.3 使用分析模板

```python
# 用户使用模板
message = """
请为我生成今日销售总结，包括 GMV、订单数、客单价、利润、退款情况，并给出主要原因分析。
"""

# AI会按照模板格式输出：
# 📌【核心结论】
# 📊【关键数据】
# 📈【详细分析】
# 📝【可执行建议】
```

## 九、优化建议

### 9.1 当前实现

✅ **已完成**：
- 完整的 System Prompt
- 数据上下文自动注入
- 工具函数实现
- 分析模板文档

### 9.2 待优化

⏳ **待实现**：
1. **工具调用集成**：将工具函数集成到AI对话流程中（Function Calling）
2. **前端模板按钮**：在前端添加快捷模板按钮
3. **Markdown渲染**：优化AI回答的Markdown渲染
4. **数据可视化**：在对话中展示图表
5. **文件处理**：实现Excel/CSV/JSON文件解析

### 9.3 扩展方向

1. **更智能的关键词匹配**：使用NLP模型进行意图识别
2. **更多数据源**：集成原始数据表、报表快照等
3. **预测分析**：基于历史数据进行趋势预测
4. **多语言支持**：支持英文对话
5. **语音交互**：支持语音输入和输出

## 十、总结

FrogGPT 完整 Prompt 体系已经实现，包括：

1. ✅ **System Prompt**：专业的角色定义和规则约束
2. ✅ **数据上下文**：智能的数据注入机制
3. ✅ **工具函数**：5个核心工具函数
4. ✅ **分析模板**：8个常用分析模板
5. ✅ **标准格式**：统一的回答输出格式

系统已经可以投入使用，AI 会基于真实数据进行分析，并提供可执行的运营建议。

